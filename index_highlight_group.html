<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>

<script>

// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", 1100)
    .attr("height", 1000)
  .append("g")
    .attr("transform", "translate(50,50)");

//Read the data
d3.csv("https://flunky.github.io/cars2017.csv", function(data) {

  // Add X axis
  var x = d3.scaleLinear()
    .domain([10, 150])
    .range([0, 800]);
  svg.append("g")
    .attr("transform", "translate(0,800)")
    .call(d3.axisBottom(x).tickValues([10,20,50,100,150]));

  // Add Y axis
  var y = d3.scaleLinear()
    .domain([10, 150])
    .range([800, 0]);
  svg.append("g").attr("transform", "translate(0,0)")
    .call(d3.axisLeft(y).tickValues([10,20,50,100,150]));

  // create a list of keys
  var keys = ["Acura", "Alfa Romeo", "Aston Martin", "Audi", "Bentley", "BMW", 
              "Cadillac", "Chevrolet", "Chrysler", "Dodge", "Ferrari", "Fiat", 
              "Ford", "Genesis", "GMC", "Honda", "Hyundai", "Infiniti", "Jaguar", 
              "Jeep", "Kia", "Lamborghini", "Land Rover", "Lexus", "Lincoln", 
              "Lotus", "Maserati", "Mazda", "McLaren Automotive", "Mercedes-Benz",
              "MINI", "Mitsubishi", "Nissan", "Porsche", "Ram", "Rolls-Royce", 
              "Roush Performance", "smart", "Subaru", "Tesla", "Toyota", 
              "Volkswagen", "Volvo"]
  
  var color = d3.scaleSequential().domain(keys)
  .interpolator(d3.interpolateViridis);


  // Highlight the make that is hovered
  var highlight = function(d){

    selected_make = d.Make

    d3.selectAll(".dot")
      .transition()
      .duration(200)
      .style("fill", "lightgrey")
      .attr("r", 3)

    d3.selectAll("." + selected_make)
      .transition()
      .duration(200)
      .style("fill", function (d) { return color(d) })
      .attr("r", 7)
  }

  // Highlight the make that is hovered
  var doNotHighlight = function(){
    d3.selectAll(".dot")
      .transition()
      .duration(200)
      .style("fill", "lightgrey")
      .attr("r", 5)
  }

  // Add dots
  svg.append('g')
    .selectAll("dot")
    .data(data)
    .enter()
    .append("circle")
      .attr("class", function (d) { return "dot " + d.Make } )
      .attr("cx", function (d) { return x(d.AverageCityMPG); } )
      .attr("cy", function (d) { return y(d.AverageHighwayMPG); } )
      .attr("r", 5)
      .style("fill", function (d) { return color(d) } )
    .on("mouseover", highlight)
    .on("mouseleave", doNotHighlight )

// Add one dot in the legend for each name.
svg.selectAll("mydots")
  .data(keys)
  .enter()
  .append("circle")
    .attr("cx", 860)
    .attr("cy", function(d,i){ return 15 + i*20}) // 100 is where the first dot appears. 25 is the distance between dots
    .attr("r", 5)
    .style("fill", function(d){ return color(d)})

// Add one dot in the legend for each name.
svg.selectAll("mylabels")
  .data(keys)
  .enter()
  .append("text")
    .attr("x", 880)
    .attr("y", function(d,i){ return 20 + i*20}) // 100 is where the first dot appears. 25 is the distance between dots
    .style("fill", function(d){ return color(d)})
    .text(function(d){ return d})
    .attr("text-anchor", "left")
    .style("alignment-baseline", "middle")

})

</script>
